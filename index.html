<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vite + TS</title>
  <script type="module" crossorigin>var V=Object.defineProperty;var R=s=>{throw TypeError(s)};var X=(s,t,e)=>t in s?V(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var U=(s,t,e)=>X(s,typeof t!="symbol"?t+"":t,e),_=(s,t,e)=>t.has(s)||R("Cannot "+e);var o=(s,t,e)=>(_(s,t,"read from private field"),e?e.call(s):t.get(s)),r=(s,t,e)=>t.has(s)?R("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),a=(s,t,e,i)=>(_(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const N of c.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&i(N)}).observe(document,{childList:!0,subtree:!0});function e(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=e(n);fetch(n.href,c)}})();function $(s,t={},...e){const i=document.createElement(s);for(const[n,c]of Object.entries(t))i.setAttribute(n,c);for(const n of e)typeof n=="string"?i.appendChild(document.createTextNode(n)):i.appendChild(n);return i}var h=(s=>(s[s.Tempo=0]="Tempo",s[s.Finish=1]="Finish",s[s.NoteOn=2]="NoteOn",s[s.NoteOff=3]="NoteOff",s))(h||{});function q(s){return{position:-1/0,type:h.Tempo,bpm:s}}function D(...s){return s.map(t=>({position:-1/0,part:t,type:h.Finish}))}const G=[0,2,4,5,7,9,11,12];function Y(s){return G.map(t=>t+24).map((t,e)=>[{position:e,part:s,type:h.NoteOn,pitch:t},{position:e+.9,part:s,type:h.NoteOff,pitch:t}]).flat()}const Z={title:"Bass Scale",compose:({bass:s,drum:t,chord:e,lead:i})=>[q(120),...D(t,e,i),...Y(s),{position:G.length,type:h.Finish,part:s}]},J=[0,2,4,5,7,9,11,12];function B(s){return J.map(t=>t+48).map((t,e)=>[{position:e,part:s,type:h.NoteOn,pitch:t},{position:e+.9,part:s,type:h.NoteOff,pitch:t}]).flat()}const tt={title:"Lead Scale",compose:({bass:s,drum:t,chord:e,lead:i})=>[q(120),...D(s,t,e),...B(i),{position:J.length,type:h.Finish,part:i}]},et={title:"Twinkle Twinkle Little Star",compose:({bass:s,drum:t,chord:e,lead:i})=>{const n=(()=>{const S=[[0,1,0],[0,1,0],[7,1,0],[7,1,0],[9,1,0],[9,1,0],[7,2,0],[5,1,0],[5,1,0],[4,1,0],[4,1,0],[2,1,0],[2,1,0],[0,2,0]],v=[[7,1,0],[7,1,0],[5,1,0],[5,1,0],[4,1,0],[4,1,0],[2,2,0]],z=[...S,...v,...v,...S];let A=0;const T=[];for(const W of z)T.push([W[0],W[1],A]),A+=W[1];return T})();function c(S,v){return[...v.map(([z,A,T])=>[{position:T,part:S,type:h.NoteOn,pitch:z},{position:T+A-.1,part:S,type:h.NoteOff,pitch:z}]).flat(),{position:(v.at(-1)??[0,0,0])[2]+.1,type:h.Finish,part:S}]}return[q(120),...D(s,t,e),...c(i,n)]}},Q=[Z,tt,et];function st(){return new Worker(new URL(""+new URL("worker-DxAA_dw-.js",import.meta.url).href,import.meta.url),{type:"module"})}var b;class ot{constructor(t){r(this,b);a(this,b,t)}noteOn(t,e){console.log("noteOn",o(this,b),t,e)}noteOff(t,e){console.log("noteOff",o(this,b),t,e)}allNotesOff(){console.log("allNotesOff",o(this,b))}}b=new WeakMap;class M{constructor(t){U(this,"synthesizer");this.synthesizer=new ot(t)}}function nt(){return{bass:new M("bass"),drum:new M("drum"),chord:new M("chord"),lead:new M("lead")}}var j,m,C,f,y,F,k,w,x,P,L,E;class it{constructor(t){r(this,L);r(this,j);r(this,m,st());r(this,C,nt());r(this,f,!1);r(this,y,[]);r(this,F,()=>{});r(this,k,0);r(this,w,0);r(this,x,6e4/120);r(this,P,new Set);a(this,j,t),o(this,m).onmessage=e=>{o(this,f)&&e.data===2&&this.schedule()}}schedule(){const t=window.performance.now()-o(this,k)+100;for(;o(this,f)&&o(this,L,E)<t;){const e=o(this,y).shift();if(e)switch(e.type){case h.Tempo:a(this,x,6e4/e.bpm);break;case h.Finish:o(this,P).add(e.part),o(this,P).size===4&&o(this,j).stop();break;case h.NoteOn:e.part.synthesizer.noteOn(e.pitch,o(this,L,E));break;case h.NoteOff:e.part.synthesizer.noteOff(e.pitch,o(this,L,E));break}}}changeChart(t){a(this,F,()=>a(this,y,t.compose(o(this,C))))()}play(){a(this,f,!0),a(this,k,window.performance.now()+100),a(this,w,0),o(this,m).postMessage(0)}pause(){a(this,f,!1),o(this,m).postMessage(1),a(this,w,window.performance.now()-o(this,k))}resume(){a(this,f,!0),a(this,k,window.performance.now()-o(this,w)),o(this,m).postMessage(0)}stop(){a(this,f,!1),o(this,m).postMessage(1),a(this,w,0),o(this,P).clear(),o(this,F).call(this);for(const t of Object.values(o(this,C)))t.synthesizer.allNotesOff()}}j=new WeakMap,m=new WeakMap,C=new WeakMap,f=new WeakMap,y=new WeakMap,F=new WeakMap,k=new WeakMap,w=new WeakMap,x=new WeakMap,P=new WeakMap,L=new WeakSet,E=function(){return o(this,y).length===0?1/0:o(this,y)[0].position*o(this,x)};const H="#transporter",at=[["previous","⏮"],["play","▶"],["pause","⏸"],["stop","⏹"],["next","⏭"]],rt=([s,t])=>[s,$("button",{},t)],ct=()=>Object.fromEntries(at.map(rt)),ht={0:{play:!0,pause:!1,stop:!1},1:{play:!1,pause:!0,stop:!1},2:{play:!1,pause:!0,stop:!0}};var I,l;class lt{constructor(){r(this,I,$("h2"));r(this,l,ct());const t=document.querySelector(H);if(!t)throw new Error(`Transporter not found: ${H}`);const e=$("div",{},...Object.values(o(this,l)));t==null||t.append(o(this,I),e)}changeChart(t,e,i){o(this,I).innerText=t,o(this,l).previous.disabled=!e,o(this,l).next.disabled=!i}changePlayback(t){for(const[e,i]of Object.entries(ht[t]))o(this,l)[e].disabled=i}connect(t,e){o(this,l).previous.addEventListener("click",()=>t.goPrevious()),o(this,l).next.addEventListener("click",()=>t.goNext()),o(this,l).play.addEventListener("click",()=>e.play()),o(this,l).pause.addEventListener("click",()=>e.pause()),o(this,l).stop.addEventListener("click",()=>e.stop())}}I=new WeakMap,l=new WeakMap;const K=Q.length;var u,O;class pt{constructor(){r(this,u,0);r(this,O,()=>{})}goPrevious(){o(this,u)>0&&(a(this,u,o(this,u)-1),o(this,O).call(this))}goNext(){o(this,u)<K-1&&(a(this,u,o(this,u)+1),o(this,O).call(this))}connect(t,e){a(this,O,()=>{const i=Q[o(this,u)],n=i.title,c=o(this,u)>0,N=o(this,u)<K-1;t.changeChart(n,c,N),e.changeChart(i)})}start(){o(this,O).call(this)}}u=new WeakMap,O=new WeakMap;var p,d,g;class ut{constructor(){r(this,p,1);r(this,d,()=>{});r(this,g,new it(this))}changeChart(t){console.log("changeChart",t),o(this,g).changeChart(t),o(this,p)!=2&&this.stop()}play(){switch(o(this,p)){case 0:console.log("already playing");break;case 1:console.log("resume"),o(this,d).call(this,2),a(this,p,0);break;case 2:console.log("play"),o(this,d).call(this,0),a(this,p,0);break}}pause(){switch(o(this,p)){case 0:console.log("pause"),o(this,d).call(this,1),a(this,p,1);break;case 1:console.log("already paused");break;case 2:console.log("already stopped");break}}stop(){switch(o(this,p)){case 0:console.log("stop"),o(this,d).call(this,3),a(this,p,2);break;case 1:console.log("stop"),o(this,d).call(this,3),a(this,p,2);break;case 2:console.log("already stopped");break}}connect(t){a(this,d,e=>{switch(e){case 0:o(this,g).play(),t.changePlayback(0);break;case 1:o(this,g).pause(),t.changePlayback(1);break;case 2:o(this,g).resume(),t.changePlayback(0);break;case 3:o(this,g).stop(),t.changePlayback(2);break}})}}p=new WeakMap,d=new WeakMap,g=new WeakMap;function ft(){const s=new lt,t=new pt,e=new ut;s.connect(t,e),t.connect(s,e),e.connect(s),t.start()}ft();
</script>
  <style rel="stylesheet" crossorigin>:root{--red: #b23535;--green: #38ad5f;--blue: #464ca5;--white: #eeeade;--black: #282828;--text-color: var(--black);--background-color: var(--white)}@media (prefers-color-scheme: dark){:root{--text-color: var(--white);--background-color: var(--black)}}*{color:inherit;background-color:inherit;font-family:inherit}body{min-height:100vh;font-family:Arial,sans-serif;color:var(--text-color);background-color:var(--background-color);border-color:var(--text-color)}
</style>
</head>

<body>
  <div id="transporter"></div>
</body>

</html>