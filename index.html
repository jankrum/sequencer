<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vite + TS</title>
  <script type="module" crossorigin>var ot=Object.defineProperty;var X=t=>{throw TypeError(t)};var rt=(t,e,s)=>e in t?ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var T=(t,e,s)=>rt(t,typeof e!="symbol"?e+"":e,s),Z=(t,e,s)=>e.has(t)||X("Cannot "+s);var n=(t,e,s)=>(Z(t,e,"read from private field"),s?s.call(t):e.get(t)),p=(t,e,s)=>e.has(t)?X("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),a=(t,e,s,r)=>(Z(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();var G=(t=>(t[t.Dom=0]="Dom",t[t.Midi=1]="Midi",t))(G||{}),I=(t=>(t[t.Dom=0]="Dom",t[t.Midi=1]="Midi",t))(I||{}),k=(t=>(t[t.Log=0]="Log",t[t.Dom=1]="Dom",t[t.Midi=2]="Midi",t))(k||{}),u=(t=>(t[t.Playing=0]="Playing",t[t.Paused=1]="Paused",t[t.Stopped=2]="Stopped",t))(u||{}),g=(t=>(t[t.Play=0]="Play",t[t.Pause=1]="Pause",t[t.Resume=2]="Resume",t[t.Stop=3]="Stop",t))(g||{}),d=(t=>(t[t.Tempo=0]="Tempo",t[t.Finish=1]="Finish",t[t.NoteOn=2]="NoteOn",t[t.NoteOff=3]="NoteOff",t))(d||{});const it=async()=>({parts:{bass:{controller:{type:I.Dom},synthesizer:{type:k.Dom}},drum:{controller:{type:I.Dom},synthesizer:{type:k.Dom}},keys:{controller:{type:I.Dom},synthesizer:{type:k.Dom}},lead:{controller:{type:I.Dom},synthesizer:{type:k.Dom}}},transporter:{type:G.Dom}});function l(t,e={},...s){const r=document.createElement(t);for(const[o,i]of Object.entries(e))r.setAttribute(o,i);for(const o of s)typeof o=="string"?r.appendChild(document.createTextNode(o)):o&&r.appendChild(o);return r}function at(t){const e=l("h2"),s={previous:l("button",{class:"transporter-button"},"⏮"),play:l("button",{class:"transporter-button"},"▶"),pause:l("button",{class:"transporter-button"},"⏸"),stop:l("button",{class:"transporter-button"},"⏹"),next:l("button",{class:"transporter-button"},"⏭")};t.connect=(i,c)=>{s.previous.addEventListener("click",()=>i.goPrevious()),s.next.addEventListener("click",()=>i.goNext()),s.play.addEventListener("click",()=>c.play()),s.pause.addEventListener("click",()=>c.pause()),s.stop.addEventListener("click",()=>c.stop())},t.changeChart=(i,c,h)=>{e.innerText=i,s.previous.disabled=!c,s.next.disabled=!h},t.changePlayback=i=>{s.play.disabled=i===u.Playing,s.pause.disabled=i!==u.Playing,s.stop.disabled=i===u.Stopped};const r=l("div",{},...Object.values(s)),o=l("div",{id:"transporter"},e,r);t.render=()=>o}class ct{constructor(e){switch(e.type){case G.Dom:at(this);break;default:throw new Error(`Invalid Transporter type: ${e}`)}}connect(e,s){}changeChart(e,s,r){}changePlayback(e){}render(){return null}}function J(t){return{position:-1/0,type:d.Tempo,bpm:t}}function Q(...t){return t.map(e=>({position:-1/0,part:e,type:d.Finish}))}const et=[0,2,4,5,7,9,11,12];function lt(t){return et.map(e=>e+24).map((e,s)=>[{position:s,part:t,type:d.NoteOn,pitch:e},{position:s+.9,part:t,type:d.NoteOff,pitch:e}]).flat()}const ut={title:"Bass Scale",compose:({bass:t,drum:e,keys:s,lead:r})=>[J(120),...Q(e,s,r),...lt(t),{position:et.length,type:d.Finish,part:t}]},st=[0,2,4,5,7,9,11,12];function ht(t){return st.map(e=>e+48).map((e,s)=>[{position:s,part:t,type:d.NoteOn,pitch:e},{position:s+.9,part:t,type:d.NoteOff,pitch:e}]).flat()}const pt={title:"Lead Scale",compose:({bass:t,drum:e,keys:s,lead:r})=>[J(120),...Q(t,e,s),...ht(r),{position:st.length,type:d.Finish,part:r}]},dt={title:"Twinkle Twinkle Little Star",compose:({bass:t,drum:e,keys:s,lead:r})=>{const o=(()=>{const h=[[0,1,0],[0,1,0],[7,1,0],[7,1,0],[9,1,0],[9,1,0],[7,2,0],[5,1,0],[5,1,0],[4,1,0],[4,1,0],[2,1,0],[2,1,0],[0,2,0]],m=[[7,1,0],[7,1,0],[5,1,0],[5,1,0],[4,1,0],[4,1,0],[2,2,0]],U=[...h,...m,...m,...h];let q=0;const $=[];for(const K of U)$.push([K[0],K[1],q]),q+=K[1];return $})();function i(h,m){return[...m.map(([U,q,$])=>[{position:$,part:h,type:d.NoteOn,pitch:U},{position:$+q-.1,part:h,type:d.NoteOff,pitch:U}]).flat(),{position:(m.at(-1)??[0,0,0])[2]+.1,type:d.Finish,part:h}]}return[J(120),...Q(t,e,s),...i(r,o)]}},nt=[ut,pt,dt],B=nt.length;var b,P;class mt{constructor(){p(this,b,0);p(this,P,()=>{})}goPrevious(){n(this,b)>0&&(a(this,b,n(this,b)-1),n(this,P).call(this))}goNext(){n(this,b)<B-1&&(a(this,b,n(this,b)+1),n(this,P).call(this))}connect(e,s){a(this,P,()=>{const r=nt[n(this,b)],o=r.title,i=n(this,b)>0,c=n(this,b)<B-1;e.changeChart(o,i,c),s.changeChart(r)})}start(){n(this,P).call(this)}}b=new WeakMap,P=new WeakMap;const tt=12,_={min:0,max:127,step:1,default:63};var C,N,M,R;class ft{constructor(){p(this,C);p(this,N);p(this,M,()=>{});p(this,R,()=>0);const e=l("span",{},"EMPTY");a(this,C,{0:l("span",{},"%%"),1:e,2:l("span",{},"%%")}),a(this,N,l("input",{type:"range",min:_.min,max:_.max,step:_.step,value:_.default})).addEventListener("input",()=>{n(this,M).call(this)})}clear(){}get value(){return n(this,R).call(this)}makeIntoRangeControl(e,s,r,o=""){const i=n(this,C),c=i[1],h=n(this,N);i[0].textContent=e,i[2].textContent=o;const m=a(this,R,()=>s+(r-s)*Number(h.value)/_.max);a(this,M,()=>{c.textContent=m().toString()})}makeIntoOptionControl(e,s,r=""){const o=n(this,C),i=o[1],c=n(this,N);o[0].textContent=e,o[2].textContent=r;const h=a(this,R,()=>s.length*Number(c.value)/_.max);a(this,M,()=>{i.textContent=s[h()]})}render(){const e=l("label",{class:"lcd"},...Object.values(n(this,C)));return l("div",{class:"controller-module"},e,n(this,N))}}C=new WeakMap,N=new WeakMap,M=new WeakMap,R=new WeakMap;function gt(t){const e=Array.from({length:tt},()=>new ft);let s=0;t.clear=()=>{e.forEach(o=>o.clear()),s=0};function r(){if(s>=tt)throw new Error("No more controllers available");const o=e[s];return s+=1,o}t.getRangeControl=(o,i,c,h="")=>{const m=r();return m.makeIntoRangeControl(o,i,c,h),m},t.getOptionControl=(o,i,c="")=>{const h=r();return h.makeIntoOptionControl(o,i,c),h},t.render=()=>{const o=l("h2",{class:"component-title"},"Controller"),i=e.map(h=>h.render()),c=l("div",{class:"controller-row"},...i);return o.addEventListener("click",()=>{c.classList.toggle("hidden")}),l("div",{class:"controller"},o,c)}}class bt{constructor(e,s){switch(s.type){case I.Dom:gt(this);break;default:throw new Error(`Invalid Controller type: ${s}`)}}clear(){}getRangeControl(e,s,r,o=""){return{value:0}}getOptionControl(e,s,r=""){return{value:0}}render(){return null}}function yt(t){t.noteOn=(e,s)=>{console.log("noteOn",e,s)},t.noteOff=(e,s)=>{console.log("noteOff",e,s)},t.allNotesOff=()=>{console.log("allNotesOff")}}function vt(t){const e=l("h2",{class:"component-title"},"Synthesizer"),s=l("button",{style:{class:"clear-button"}},"Clear"),r=l("div",{style:{class:"message-row"}}),o=l("div",{style:{class:"synthesizer-row"}},s,r),i=l("div",{style:{class:"synthesizer"}},e,o);t.noteOn=(c,h)=>{const m=l("div",{class:"note-on"},`noteOn ${c} ${h}`);r.appendChild(m)},t.noteOff=(c,h)=>{const m=l("div",{class:"note-off"},`noteOff ${c} ${h}`);r.appendChild(m)},t.allNotesOff=()=>{const c=l("div",{class:"all-notes-off"},"allNotesOff");r.appendChild(c)},s.addEventListener("click",()=>{r.innerHTML=""}),e.addEventListener("click",()=>{o.classList.toggle("hidden")}),t.render=()=>i}class wt{constructor(e,s){switch(s.type){case k.Log:yt(this);break;case k.Dom:vt(this);break;default:throw new Error(`Invalid synthesizer type: ${s.type}`)}}noteOn(e,s){}noteOff(e,s){}allNotesOff(){}render(){return null}}var j;class H{constructor(e,s){p(this,j);T(this,"controller");T(this,"synthesizer");a(this,j,e),this.controller=new bt(e,s.controller),this.synthesizer=new wt(e,s.synthesizer)}render(){const e=l("h2",{},n(this,j).toUpperCase()),s=this.controller.render(),r=this.synthesizer.render();return s||r?l("div",{class:"part"},e,s,r):null}}j=new WeakMap;function Ot(t){return{bass:new H("bass",t.bass),drum:new H("drum",t.drum),keys:new H("keys",t.keys),lead:new H("lead",t.lead)}}const Y=100;function kt(){return new Worker(new URL(""+new URL("worker-DxAA_dw-.js",import.meta.url).href,import.meta.url),{type:"module"})}var F,w,D,O,x,W,L,S,V,E,z,A;class Pt{constructor(e,s){p(this,z);p(this,F);p(this,w,kt());p(this,D);p(this,O,!1);p(this,x,[]);p(this,W,()=>{});p(this,L,0);p(this,S,0);p(this,V,6e4/120);p(this,E,new Set);a(this,F,e),a(this,D,Ot(s)),n(this,w).onmessage=r=>this.schedule()}schedule(){const e=window.performance.now()-n(this,L)+Y;for(;n(this,O)&&n(this,z,A)<e;){const s=n(this,x).shift();if(s)switch(s.type){case d.Tempo:a(this,V,6e4/s.bpm);break;case d.Finish:n(this,E).add(s.part),n(this,E).size===4&&n(this,F).stop();break;case d.NoteOn:s.part.synthesizer.noteOn(s.pitch,n(this,z,A));break;case d.NoteOff:s.part.synthesizer.noteOff(s.pitch,n(this,z,A));break}}}changeChart(e){a(this,W,()=>a(this,x,e.compose(n(this,D))))()}play(){a(this,O,!0),a(this,L,window.performance.now()+Y),a(this,S,0),n(this,w).postMessage(0)}pause(){a(this,O,!1),n(this,w).postMessage(1),a(this,S,window.performance.now()-n(this,L))}resume(){a(this,O,!0),a(this,L,window.performance.now()-n(this,S)),n(this,w).postMessage(0)}stop(){a(this,O,!1),n(this,w).postMessage(1),a(this,S,0),n(this,E).clear(),n(this,W).call(this),setTimeout(()=>{for(const s of Object.values(n(this,D)))s.synthesizer.allNotesOff()},Y)}render(){const e=Object.values(n(this,D)).map(s=>s.render());return e.some(s=>s!==null)?l("div",{id:"part-container"},...e):null}}F=new WeakMap,w=new WeakMap,D=new WeakMap,O=new WeakMap,x=new WeakMap,W=new WeakMap,L=new WeakMap,S=new WeakMap,V=new WeakMap,E=new WeakMap,z=new WeakSet,A=function(){return n(this,x).length===0?1/0:n(this,x)[0].position*n(this,V)};var f,v,y;class Ct{constructor(e){p(this,f,u.Paused);p(this,v,()=>{});p(this,y);console.debug("Playbacker",e),a(this,y,new Pt(this,e))}changeChart(e){console.debug("changeChart",e),n(this,y).changeChart(e),n(this,f)!=u.Stopped&&this.stop()}play(){switch(n(this,f)){case u.Playing:console.debug("already playing");break;case u.Paused:console.debug("resume"),n(this,v).call(this,g.Resume),a(this,f,u.Playing);break;case u.Stopped:console.debug("play"),n(this,v).call(this,g.Play),a(this,f,u.Playing);break}}pause(){switch(n(this,f)){case u.Playing:console.debug("pause"),n(this,v).call(this,g.Pause),a(this,f,u.Paused);break;case u.Paused:console.debug("already paused");break;case u.Stopped:console.debug("already stopped");break}}stop(){switch(n(this,f)){case u.Playing:console.debug("stop"),n(this,v).call(this,g.Stop),a(this,f,u.Stopped);break;case u.Paused:console.debug("stop"),n(this,v).call(this,g.Stop),a(this,f,u.Stopped);break;case u.Stopped:console.debug("already stopped");break}}connect(e){a(this,v,s=>{switch(s){case g.Play:n(this,y).play(),e.changePlayback(u.Playing);break;case g.Pause:n(this,y).pause(),e.changePlayback(u.Paused);break;case g.Resume:n(this,y).resume(),e.changePlayback(u.Playing);break;case g.Stop:n(this,y).stop(),e.changePlayback(u.Stopped);break}})}render(){return n(this,y).render()}}f=new WeakMap,v=new WeakMap,y=new WeakMap;function Nt(t){const e=new ct(t.transporter),s=new mt,r=new Ct(t.parts);e.connect(s,r),s.connect(e,r),r.connect(e);const o=e.render(),i=r.render(),c=o||i?l("div",{},o,i):null;return s.start(),c}it().then(t=>(e=>e?document.body.append(e):null)(Nt(t)));
</script>
  <style rel="stylesheet" crossorigin>:root{--red: #b23535;--green: #38ad5f;--blue: #464ca5;--white: #eeeade;--black: #282828;--text-color: var(--black);--background-color: var(--white)}@media (prefers-color-scheme: dark){:root{--text-color: var(--white);--background-color: var(--black)}}*{color:inherit;background-color:inherit;border-color:inherit;font-family:inherit;box-sizing:inherit}body{min-height:100vh;font-family:Arial,sans-serif;color:var(--text-color);background-color:var(--background-color);border-color:var(--text-color);box-sizing:border-box;padding:0;margin:0}.transporter-button{width:2em;height:2em;border:1.5px solid;border-radius:50%;font-size:2.5rem;padding:1rem;margin:0 .5rem 2rem;cursor:pointer;color:var(--background-color);background-color:var(--text-color);transition:transform .2s}.transporter-button:hover:enabled{transform:scale(1.1)}.transporter-button:disabled{color:var(--text-color);background-color:var(--background-color);cursor:auto}#transporter{text-align:center;border-bottom:1px solid var(--text-color)}.lcd{padding:.5em 1em;border-radius:5px;width:16ch;min-height:4em;line-height:1.5;text-align:left;font-family:hd44780,monospace;color:var(--background-color);background-color:var(--text-color)}input[type=range]{margin-top:1em;width:100%}.controller-module{padding:1em;display:flex;flex-direction:column;align-items:center;border:1px solid;font-size:1vw}.component-title{margin-top:0;margin-bottom:0;width:100%;height:3rem;line-height:3rem;cursor:pointer;-webkit-user-select:none;user-select:none}.controller-row{border-top:1px solid;justify-content:center;align-items:center;overflow-y:scroll;height:40vw}.controller{padding-top:0;border:1px solid}.note-on{color:var(--green)}.note-off{color:var(--red)}.all-notes-off{color:var(--blue)}.message-row{width:100%;height:10vw;overflow-y:scroll}.synthesizer-row{width:100%}.synthesizer{display:flex;flex-direction:column;align-items:center;width:100%;border:1px solid}.part{text-align:center;border:1px solid;min-width:20%}#part-container{display:flex;flex-wrap:wrap;justify-content:space-around;align-items:start}.hidden{display:none}
</style>
</head>

<body>
</body>

</html>