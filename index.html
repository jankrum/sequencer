<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vite + TS</title>
  <script type="module" crossorigin>var A=Object.defineProperty;var G=e=>{throw TypeError(e)};var B=(e,t,s)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var J=(e,t,s)=>B(e,typeof t!="symbol"?t+"":t,s),Q=(e,t,s)=>t.has(e)||G("Cannot "+s);var o=(e,t,s)=>(Q(e,t,"read from private field"),s?s.call(e):t.get(e)),l=(e,t,s)=>t.has(e)?G("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),a=(e,t,s,r)=>(Q(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var H=(e=>(e[e.Dom=0]="Dom",e[e.Midi=1]="Midi",e))(H||{}),F=(e=>(e[e.Dom=0]="Dom",e[e.Midi=1]="Midi",e))(F||{}),I=(e=>(e[e.Dom=0]="Dom",e[e.Midi=1]="Midi",e))(I||{}),c=(e=>(e[e.Playing=0]="Playing",e[e.Paused=1]="Paused",e[e.Stopped=2]="Stopped",e))(c||{}),d=(e=>(e[e.Play=0]="Play",e[e.Pause=1]="Pause",e[e.Resume=2]="Resume",e[e.Stop=3]="Stop",e))(d||{}),h=(e=>(e[e.Tempo=0]="Tempo",e[e.Finish=1]="Finish",e[e.NoteOn=2]="NoteOn",e[e.NoteOff=3]="NoteOff",e))(h||{});const ee=async()=>({parts:{bass:{controller:{type:F.Dom},synthesizer:{type:I.Dom}},drum:{controller:{type:F.Dom},synthesizer:{type:I.Dom}},keys:{controller:{type:F.Dom},synthesizer:{type:I.Dom}},lead:{controller:{type:F.Dom},synthesizer:{type:I.Dom}}},transporter:{type:H.Dom}});function m(e,t={},...s){const r=document.createElement(e);for(const[n,i]of Object.entries(t))r.setAttribute(n,i);for(const n of s)typeof n=="string"?r.appendChild(document.createTextNode(n)):n&&r.appendChild(n);return r}function te(e){const t=m("h2"),s={previous:m("button",{},"⏮"),play:m("button",{},"▶"),pause:m("button",{},"⏸"),stop:m("button",{},"⏹"),next:m("button",{},"⏭")};e.connect=(i,u)=>{s.previous.addEventListener("click",()=>i.goPrevious()),s.next.addEventListener("click",()=>i.goNext()),s.play.addEventListener("click",()=>u.play()),s.pause.addEventListener("click",()=>u.pause()),s.stop.addEventListener("click",()=>u.stop())},e.changeChart=(i,u,y)=>{t.innerText=i,s.previous.disabled=!u,s.next.disabled=!y},e.changePlayback=i=>{s.play.disabled=i===c.Playing,s.pause.disabled=i!==c.Playing,s.stop.disabled=i===c.Stopped};const r=m("div",{},...Object.values(s)),n=m("div",{},t,r);e.render=()=>n}class se{constructor(t){switch(t.type){case H.Dom:te(this);break;default:throw new Error(`Invalid TransporterType: ${t}`)}}connect(t,s){}changeChart(t,s,r){}changePlayback(t){}render(){return null}}function K(e){return{position:-1/0,type:h.Tempo,bpm:e}}function T(...e){return e.map(t=>({position:-1/0,part:t,type:h.Finish}))}const X=[0,2,4,5,7,9,11,12];function oe(e){return X.map(t=>t+24).map((t,s)=>[{position:s,part:e,type:h.NoteOn,pitch:t},{position:s+.9,part:e,type:h.NoteOff,pitch:t}]).flat()}const ne={title:"Bass Scale",compose:({bass:e,drum:t,keys:s,lead:r})=>[K(120),...T(t,s,r),...oe(e),{position:X.length,type:h.Finish,part:e}]},Y=[0,2,4,5,7,9,11,12];function ie(e){return Y.map(t=>t+48).map((t,s)=>[{position:s,part:e,type:h.NoteOn,pitch:t},{position:s+.9,part:e,type:h.NoteOff,pitch:t}]).flat()}const re={title:"Lead Scale",compose:({bass:e,drum:t,keys:s,lead:r})=>[K(120),...T(e,t,s),...ie(r),{position:Y.length,type:h.Finish,part:r}]},ae={title:"Twinkle Twinkle Little Star",compose:({bass:e,drum:t,keys:s,lead:r})=>{const n=(()=>{const y=[[0,1,0],[0,1,0],[7,1,0],[7,1,0],[9,1,0],[9,1,0],[7,2,0],[5,1,0],[5,1,0],[4,1,0],[4,1,0],[2,1,0],[2,1,0],[0,2,0]],M=[[7,1,0],[7,1,0],[5,1,0],[5,1,0],[4,1,0],[4,1,0],[2,2,0]],R=[...y,...M,...M,...y];let W=0;const x=[];for(const q of R)x.push([q[0],q[1],W]),W+=q[1];return x})();function i(y,M){return[...M.map(([R,W,x])=>[{position:x,part:y,type:h.NoteOn,pitch:R},{position:x+W-.1,part:y,type:h.NoteOff,pitch:R}]).flat(),{position:(M.at(-1)??[0,0,0])[2]+.1,type:h.Finish,part:y}]}return[K(120),...T(e,t,s),...i(r,n)]}},Z=[ne,re,ae],V=Z.length;var f,k;class ce{constructor(){l(this,f,0);l(this,k,()=>{})}goPrevious(){o(this,f)>0&&(a(this,f,o(this,f)-1),o(this,k).call(this))}goNext(){o(this,f)<V-1&&(a(this,f,o(this,f)+1),o(this,k).call(this))}connect(t,s){a(this,k,()=>{const r=Z[o(this,f)],n=r.title,i=o(this,f)>0,u=o(this,f)<V-1;t.changeChart(n,i,u),s.changeChart(r)})}start(){o(this,k).call(this)}}f=new WeakMap,k=new WeakMap;var O;class le{constructor(t){l(this,O);a(this,O,t)}noteOn(t,s){console.log("noteOn",o(this,O),t,s)}noteOff(t,s){console.log("noteOff",o(this,O),t,s)}allNotesOff(){console.log("allNotesOff",o(this,O))}}O=new WeakMap;class ${constructor(t){J(this,"synthesizer");this.synthesizer=new le(t)}}function he(){return{bass:new $("bass"),drum:new $("drum"),keys:new $("keys"),lead:new $("lead")}}const U=100;function ue(){return new Worker(new URL(""+new URL("worker-DxAA_dw-.js",import.meta.url).href,import.meta.url),{type:"module"})}var j,b,z,w,v,C,N,S,_,D,L,E;class pe{constructor(t){l(this,L);l(this,j);l(this,b,ue());l(this,z,he());l(this,w,!1);l(this,v,[]);l(this,C,()=>{});l(this,N,0);l(this,S,0);l(this,_,6e4/120);l(this,D,new Set);a(this,j,t),o(this,b).onmessage=s=>this.schedule()}schedule(){const t=window.performance.now()-o(this,N)+U;for(;o(this,w)&&o(this,L,E)<t;){const s=o(this,v).shift();if(s)switch(s.type){case h.Tempo:a(this,_,6e4/s.bpm);break;case h.Finish:o(this,D).add(s.part),o(this,D).size===4&&o(this,j).stop();break;case h.NoteOn:s.part.synthesizer.noteOn(s.pitch,o(this,L,E));break;case h.NoteOff:s.part.synthesizer.noteOff(s.pitch,o(this,L,E));break}}}changeChart(t){a(this,C,()=>a(this,v,t.compose(o(this,z))))()}play(){a(this,w,!0),a(this,N,window.performance.now()+U),a(this,S,0),o(this,b).postMessage(0)}pause(){a(this,w,!1),o(this,b).postMessage(1),a(this,S,window.performance.now()-o(this,N))}resume(){a(this,w,!0),a(this,N,window.performance.now()-o(this,S)),o(this,b).postMessage(0)}stop(){a(this,w,!1),o(this,b).postMessage(1),a(this,S,0),o(this,D).clear(),o(this,C).call(this),setTimeout(()=>{for(const s of Object.values(o(this,z)))s.synthesizer.allNotesOff()},U)}}j=new WeakMap,b=new WeakMap,z=new WeakMap,w=new WeakMap,v=new WeakMap,C=new WeakMap,N=new WeakMap,S=new WeakMap,_=new WeakMap,D=new WeakMap,L=new WeakSet,E=function(){return o(this,v).length===0?1/0:o(this,v)[0].position*o(this,_)};var p,g,P;class de{constructor(t){l(this,p,c.Paused);l(this,g,()=>{});l(this,P,new pe(this));console.debug("Playbacker",t)}changeChart(t){console.debug("changeChart",t),o(this,P).changeChart(t),o(this,p)!=c.Stopped&&this.stop()}play(){switch(o(this,p)){case c.Playing:console.debug("already playing");break;case c.Paused:console.debug("resume"),o(this,g).call(this,d.Resume),a(this,p,c.Playing);break;case c.Stopped:console.debug("play"),o(this,g).call(this,d.Play),a(this,p,c.Playing);break}}pause(){switch(o(this,p)){case c.Playing:console.debug("pause"),o(this,g).call(this,d.Pause),a(this,p,c.Paused);break;case c.Paused:console.debug("already paused");break;case c.Stopped:console.debug("already stopped");break}}stop(){switch(o(this,p)){case c.Playing:console.debug("stop"),o(this,g).call(this,d.Stop),a(this,p,c.Stopped);break;case c.Paused:console.debug("stop"),o(this,g).call(this,d.Stop),a(this,p,c.Stopped);break;case c.Stopped:console.debug("already stopped");break}}connect(t){a(this,g,s=>{switch(s){case d.Play:o(this,P).play(),t.changePlayback(c.Playing);break;case d.Pause:o(this,P).pause(),t.changePlayback(c.Paused);break;case d.Resume:o(this,P).resume(),t.changePlayback(c.Playing);break;case d.Stop:o(this,P).stop(),t.changePlayback(c.Stopped);break}})}}p=new WeakMap,g=new WeakMap,P=new WeakMap;function fe(e){const t=new se(e.transporter),s=new ce,r=new de(e.parts);t.connect(s,r),s.connect(t,r),r.connect(t);const n=t.render(),i=n?m("div",{},n):null;return s.start(),i}ee().then(e=>(t=>t?document.body.append(t):null)(fe(e)));
</script>
  <style rel="stylesheet" crossorigin>:root{--red: #b23535;--green: #38ad5f;--blue: #464ca5;--white: #eeeade;--black: #282828;--text-color: var(--black);--background-color: var(--white)}@media (prefers-color-scheme: dark){:root{--text-color: var(--white);--background-color: var(--black)}}*{color:inherit;background-color:inherit;font-family:inherit}body{min-height:100vh;font-family:Arial,sans-serif;color:var(--text-color);background-color:var(--background-color);border-color:var(--text-color)}
</style>
</head>

<body>
</body>

</html>