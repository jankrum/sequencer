<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vite + TS</title>
  <script type="module" crossorigin>var R=Object.defineProperty;var z=i=>{throw TypeError(i)};var U=(i,t,s)=>t in i?R(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var A=(i,t,s)=>U(i,typeof t!="symbol"?t+"":t,s),M=(i,t,s)=>t.has(i)||z("Cannot "+s);var e=(i,t,s)=>(M(i,t,"read from private field"),s?s.call(i):t.get(i)),c=(i,t,s)=>t.has(i)?z("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,s),n=(i,t,s,a)=>(M(i,t,"write to private field"),a?a.call(i,s):t.set(i,s),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const S of r.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&a(S)}).observe(document,{childList:!0,subtree:!0});function s(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=s(o);fetch(o.href,r)}})();function j(i,t={},...s){const a=document.createElement(i);for(const[o,r]of Object.entries(t))a.setAttribute(o,r);for(const o of s)typeof o=="string"?a.appendChild(document.createTextNode(o)):a.appendChild(o);return a}var h=(i=>(i[i.Tempo=0]="Tempo",i[i.Finish=1]="Finish",i[i.NoteOn=2]="NoteOn",i[i.NoteOff=3]="NoteOff",i))(h||{});const E=[0,2,4,5,7,9,11,12],_={title:"Bass Scale",compose:(i,t,s,a)=>[{position:-1/0,type:h.Tempo,bpm:120},{position:-1/0,part:t,type:h.Finish},{position:-1/0,part:s,type:h.Finish},{position:-1/0,part:a,type:h.Finish},...E.map((o,r)=>[{position:r,part:i,type:h.NoteOn,pitch:o+24},{position:r+.9,part:i,type:h.NoteOff,pitch:o+24}]).flat(),{position:E.length,type:h.Finish,part:i}]},q=[0,2,4,5,7,9,11,12],H={title:"Lead Scale",compose:(i,t,s,a)=>[{position:-1/0,type:h.Tempo,bpm:120},{position:-1/0,part:i,type:h.Finish},{position:-1/0,part:t,type:h.Finish},{position:-1/0,part:s,type:h.Finish},...q.map((o,r)=>[{position:r,part:a,type:h.NoteOn,pitch:o},{position:r+.9,part:a,type:h.NoteOff,pitch:o}]).flat(),{position:q.length,type:h.Finish,part:a}]},$=[_,H];function K(){return new Worker(new URL(""+new URL("worker-DxAA_dw-.js",import.meta.url).href,import.meta.url),{type:"module"})}var b;class G{constructor(t){c(this,b);n(this,b,t)}noteOn(t,s){console.log("noteOn",e(this,b),t,s)}noteOff(t,s){console.log("noteOff",e(this,b),t,s)}allNotesOff(){console.log("allNotesOff",e(this,b))}}b=new WeakMap;class T{constructor(t){A(this,"synthesizer");this.synthesizer=new G(t)}}function J(){return{bass:new T("bass"),drum:new T("drum"),chord:new T("chord"),lead:new T("lead")}}var v,m,y,f,w,F,k,O,I,P,L,x;class Q{constructor(t){c(this,L);c(this,v);c(this,m,K());c(this,y,J());c(this,f,!1);c(this,w,[]);c(this,F,()=>{});c(this,k,0);c(this,O,0);c(this,I,6e4/120);c(this,P,new Set);n(this,v,t),e(this,m).onmessage=s=>{e(this,f)&&s.data===2&&this.schedule()}}schedule(){const t=window.performance.now()-e(this,k)+100;for(;e(this,f)&&e(this,L,x)<t;){const s=e(this,w).shift();if(s)switch(s.type){case h.Tempo:n(this,I,6e4/s.bpm);break;case h.Finish:e(this,P).add(s.part),e(this,P).size===4&&e(this,v).stop();break;case h.NoteOn:s.part.synthesizer.noteOn(s.pitch,e(this,L,x));break;case h.NoteOff:s.part.synthesizer.noteOff(s.pitch,e(this,L,x));break}}}changeChart(t){n(this,F,()=>n(this,w,t.compose(e(this,y).bass,e(this,y).drum,e(this,y).chord,e(this,y).lead)))()}play(){n(this,f,!0),n(this,k,window.performance.now()+100),n(this,O,0),e(this,m).postMessage(0)}pause(){n(this,f,!1),e(this,m).postMessage(1),n(this,O,window.performance.now()-e(this,k))}resume(){n(this,f,!0),n(this,k,window.performance.now()-e(this,O)),e(this,m).postMessage(0)}stop(){n(this,f,!1),e(this,m).postMessage(1),n(this,O,0),e(this,P).clear(),e(this,F).call(this);for(const t of Object.values(e(this,y)))t.synthesizer.allNotesOff()}}v=new WeakMap,m=new WeakMap,y=new WeakMap,f=new WeakMap,w=new WeakMap,F=new WeakMap,k=new WeakMap,O=new WeakMap,I=new WeakMap,P=new WeakMap,L=new WeakSet,x=function(){return e(this,w).length===0?1/0:e(this,w)[0].position*e(this,I)};const D="#transporter",V=[["previous","⏮"],["play","▶"],["pause","⏸"],["stop","⏹"],["next","⏭"]],X=([i,t])=>[i,j("button",{},t)],Y=()=>Object.fromEntries(V.map(X)),Z={0:{play:!0,pause:!1,stop:!1},1:{play:!1,pause:!0,stop:!1},2:{play:!1,pause:!0,stop:!0}};var C,l;class B{constructor(){c(this,C,j("h2"));c(this,l,Y());const t=document.querySelector(D);if(!t)throw new Error(`Transporter not found: ${D}`);const s=j("div",{},...Object.values(e(this,l)));t==null||t.append(e(this,C),s)}changeChart(t,s,a){e(this,C).innerText=t,e(this,l).previous.disabled=!s,e(this,l).next.disabled=!a}changePlayback(t){for(const[s,a]of Object.entries(Z[t]))e(this,l)[s].disabled=a}connect(t,s){e(this,l).previous.addEventListener("click",()=>t.goPrevious()),e(this,l).next.addEventListener("click",()=>t.goNext()),e(this,l).play.addEventListener("click",()=>s.play()),e(this,l).pause.addEventListener("click",()=>s.pause()),e(this,l).stop.addEventListener("click",()=>s.stop())}}C=new WeakMap,l=new WeakMap;const W=$.length;var u,N;class tt{constructor(){c(this,u,0);c(this,N,()=>{})}goPrevious(){e(this,u)>0&&(n(this,u,e(this,u)-1),e(this,N).call(this))}goNext(){e(this,u)<W-1&&(n(this,u,e(this,u)+1),e(this,N).call(this))}connect(t,s){n(this,N,()=>{const a=$[e(this,u)],o=a.title,r=e(this,u)>0,S=e(this,u)<W-1;t.changeChart(o,r,S),s.changeChart(a)})}start(){e(this,N).call(this)}}u=new WeakMap,N=new WeakMap;var p,d,g;class et{constructor(){c(this,p,1);c(this,d,()=>{});c(this,g,new Q(this))}changeChart(t){console.log("changeChart",t),e(this,g).changeChart(t),e(this,p)!=2&&this.stop()}play(){switch(e(this,p)){case 0:console.log("already playing");break;case 1:console.log("resume"),e(this,d).call(this,2),n(this,p,0);break;case 2:console.log("play"),e(this,d).call(this,0),n(this,p,0);break}}pause(){switch(e(this,p)){case 0:console.log("pause"),e(this,d).call(this,1),n(this,p,1);break;case 1:console.log("already paused");break;case 2:console.log("already stopped");break}}stop(){switch(e(this,p)){case 0:console.log("stop"),e(this,d).call(this,3),n(this,p,2);break;case 1:console.log("stop"),e(this,d).call(this,3),n(this,p,2);break;case 2:console.log("already stopped");break}}connect(t){n(this,d,s=>{switch(s){case 0:e(this,g).play(),t.changePlayback(0);break;case 1:e(this,g).pause(),t.changePlayback(1);break;case 2:e(this,g).resume(),t.changePlayback(0);break;case 3:e(this,g).stop(),t.changePlayback(2);break}})}}p=new WeakMap,d=new WeakMap,g=new WeakMap;function st(){const i=new B,t=new tt,s=new et;i.connect(t,s),t.connect(i,s),s.connect(i),t.start()}st();
</script>
  <style rel="stylesheet" crossorigin>:root{--red: #b23535;--green: #38ad5f;--blue: #464ca5;--white: #eeeade;--black: #282828;--text-color: var(--black);--background-color: var(--white)}@media (prefers-color-scheme: dark){:root{--text-color: var(--white);--background-color: var(--black)}}*{color:inherit;background-color:inherit;font-family:inherit}body{min-height:100vh;font-family:Arial,sans-serif;color:var(--text-color);background-color:var(--background-color);border-color:var(--text-color)}
</style>
</head>

<body>
  <div id="transporter"></div>
</body>

</html>