<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vite + TS</title>
  <script type="module" crossorigin>var ot=Object.defineProperty;var X=t=>{throw TypeError(t)};var rt=(t,e,s)=>e in t?ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Y=(t,e,s)=>rt(t,typeof e!="symbol"?e+"":e,s),Z=(t,e,s)=>e.has(t)||X("Cannot "+s);var n=(t,e,s)=>(Z(t,e,"read from private field"),s?s.call(t):e.get(t)),u=(t,e,s)=>e.has(t)?X("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),a=(t,e,s,r)=>(Z(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();var J=(t=>(t[t.Dom=0]="Dom",t[t.Midi=1]="Midi",t))(J||{}),_=(t=>(t[t.Dom=0]="Dom",t[t.Midi=1]="Midi",t))(_||{}),I=(t=>(t[t.Log=0]="Log",t[t.Dom=1]="Dom",t[t.Midi=2]="Midi",t))(I||{}),l=(t=>(t[t.Playing=0]="Playing",t[t.Paused=1]="Paused",t[t.Stopped=2]="Stopped",t))(l||{}),g=(t=>(t[t.Play=0]="Play",t[t.Pause=1]="Pause",t[t.Resume=2]="Resume",t[t.Stop=3]="Stop",t))(g||{}),d=(t=>(t[t.Tempo=0]="Tempo",t[t.Finish=1]="Finish",t[t.NoteOn=2]="NoteOn",t[t.NoteOff=3]="NoteOff",t))(d||{});const it=async()=>({parts:{bass:{controller:{type:_.Dom},synthesizer:{type:I.Log}},drum:{controller:{type:_.Dom},synthesizer:{type:I.Log}},keys:{controller:{type:_.Dom},synthesizer:{type:I.Log}},lead:{controller:{type:_.Dom},synthesizer:{type:I.Log}}},transporter:{type:J.Dom}});function p(t,e={},...s){const r=document.createElement(t);for(const[o,i]of Object.entries(e))r.setAttribute(o,i);for(const o of s)typeof o=="string"?r.appendChild(document.createTextNode(o)):o&&r.appendChild(o);return r}function at(t){const e=p("h2"),s={previous:p("button",{class:"transporter-button"},"⏮"),play:p("button",{class:"transporter-button"},"▶"),pause:p("button",{class:"transporter-button"},"⏸"),stop:p("button",{class:"transporter-button"},"⏹"),next:p("button",{class:"transporter-button"},"⏭")};t.connect=(i,c)=>{s.previous.addEventListener("click",()=>i.goPrevious()),s.next.addEventListener("click",()=>i.goNext()),s.play.addEventListener("click",()=>c.play()),s.pause.addEventListener("click",()=>c.pause()),s.stop.addEventListener("click",()=>c.stop())},t.changeChart=(i,c,h)=>{e.innerText=i,s.previous.disabled=!c,s.next.disabled=!h},t.changePlayback=i=>{s.play.disabled=i===l.Playing,s.pause.disabled=i!==l.Playing,s.stop.disabled=i===l.Stopped};const r=p("div",{},...Object.values(s)),o=p("div",{id:"transporter"},e,r);t.render=()=>o}class ct{constructor(e){switch(e.type){case J.Dom:at(this);break;default:throw new Error(`Invalid Transporter type: ${e}`)}}connect(e,s){}changeChart(e,s,r){}changePlayback(e){}render(){return null}}function Q(t){return{position:-1/0,type:d.Tempo,bpm:t}}function T(...t){return t.map(e=>({position:-1/0,part:e,type:d.Finish}))}const et=[0,2,4,5,7,9,11,12];function lt(t){return et.map(e=>e+24).map((e,s)=>[{position:s,part:t,type:d.NoteOn,pitch:e},{position:s+.9,part:t,type:d.NoteOff,pitch:e}]).flat()}const ut={title:"Bass Scale",compose:({bass:t,drum:e,keys:s,lead:r})=>[Q(120),...T(e,s,r),...lt(t),{position:et.length,type:d.Finish,part:t}]},st=[0,2,4,5,7,9,11,12];function pt(t){return st.map(e=>e+48).map((e,s)=>[{position:s,part:t,type:d.NoteOn,pitch:e},{position:s+.9,part:t,type:d.NoteOff,pitch:e}]).flat()}const ht={title:"Lead Scale",compose:({bass:t,drum:e,keys:s,lead:r})=>[Q(120),...T(t,e,s),...pt(r),{position:st.length,type:d.Finish,part:r}]},dt={title:"Twinkle Twinkle Little Star",compose:({bass:t,drum:e,keys:s,lead:r})=>{const o=(()=>{const h=[[0,1,0],[0,1,0],[7,1,0],[7,1,0],[9,1,0],[9,1,0],[7,2,0],[5,1,0],[5,1,0],[4,1,0],[4,1,0],[2,1,0],[2,1,0],[0,2,0]],f=[[7,1,0],[7,1,0],[5,1,0],[5,1,0],[4,1,0],[4,1,0],[2,2,0]],U=[...h,...f,...f,...h];let q=0;const F=[];for(const K of U)F.push([K[0],K[1],q]),q+=K[1];return F})();function i(h,f){return[...f.map(([U,q,F])=>[{position:F,part:h,type:d.NoteOn,pitch:U},{position:F+q-.1,part:h,type:d.NoteOff,pitch:U}]).flat(),{position:(f.at(-1)??[0,0,0])[2]+.1,type:d.Finish,part:h}]}return[Q(120),...T(t,e,s),...i(r,o)]}},nt=[ut,ht,dt],B=nt.length;var b,O;class mt{constructor(){u(this,b,0);u(this,O,()=>{})}goPrevious(){n(this,b)>0&&(a(this,b,n(this,b)-1),n(this,O).call(this))}goNext(){n(this,b)<B-1&&(a(this,b,n(this,b)+1),n(this,O).call(this))}connect(e,s){a(this,O,()=>{const r=nt[n(this,b)],o=r.title,i=n(this,b)>0,c=n(this,b)<B-1;e.changeChart(o,i,c),s.changeChart(r)})}start(){n(this,O).call(this)}}b=new WeakMap,O=new WeakMap;const tt=12,D={min:0,max:127,step:1,default:63};var P,C,M,R;class ft{constructor(){u(this,P);u(this,C);u(this,M,()=>{});u(this,R,()=>0);const e=p("span",{},"EMPTY");a(this,P,{0:p("span",{},"%%"),1:e,2:p("span",{},"%%")}),a(this,C,p("input",{type:"range",min:D.min,max:D.max,step:D.step,value:D.default})).addEventListener("input",()=>{n(this,M).call(this)})}clear(){}get value(){return n(this,R).call(this)}makeIntoRangeControl(e,s,r,o=""){const i=n(this,P),c=i[1],h=n(this,C);i[0].textContent=e,i[2].textContent=o;const f=a(this,R,()=>s+(r-s)*Number(h.value)/D.max);a(this,M,()=>{c.textContent=f().toString()})}makeIntoOptionControl(e,s,r=""){const o=n(this,P),i=o[1],c=n(this,C);o[0].textContent=e,o[2].textContent=r;const h=a(this,R,()=>s.length*Number(c.value)/D.max);a(this,M,()=>{i.textContent=s[h()]})}render(){const e=p("label",{class:"lcd"},...Object.values(n(this,P)));return p("div",{class:"controller-module"},e,n(this,C))}}P=new WeakMap,C=new WeakMap,M=new WeakMap,R=new WeakMap;function gt(t){const e=Array.from({length:tt},()=>new ft);let s=0;t.clear=()=>{e.forEach(o=>o.clear()),s=0};function r(){if(s>=tt)throw new Error("No more controllers available");const o=e[s];return s+=1,o}t.getRangeControl=(o,i,c,h="")=>{const f=r();return f.makeIntoRangeControl(o,i,c,h),f},t.getOptionControl=(o,i,c="")=>{const h=r();return h.makeIntoOptionControl(o,i,c),h},t.render=()=>{const o=p("h2",{class:"component-title"},"Controller"),i=e.map(h=>h.render()),c=p("div",{class:"controller-row"},...i);return o.addEventListener("click",()=>{c.classList.toggle("hidden")}),p("div",{class:"controller"},o,c)}}class bt{constructor(e,s){switch(s.type){case _.Dom:gt(this);break;default:throw new Error(`Invalid Controller type: ${s}`)}}clear(){}getRangeControl(e,s,r,o=""){return{value:0}}getOptionControl(e,s,r=""){return{value:0}}render(){return null}}function yt(t){t.noteOn=(e,s)=>{console.log("noteOn",e,s)},t.noteOff=(e,s)=>{console.log("noteOff",e,s)},t.allNotesOff=()=>{console.log("allNotesOff")}}class wt{constructor(e,s){switch(s.type){case I.Log:yt(this);break;default:throw new Error(`Invalid synthesizer type: ${s.type}`)}}noteOn(e,s){}noteOff(e,s){}allNotesOff(){}render(){return null}}var z;class A{constructor(e,s){u(this,z);Y(this,"controller");Y(this,"synthesizer");a(this,z,e),this.controller=new bt(e,s.controller),this.synthesizer=new wt(e,s.synthesizer)}render(){const e=p("h2",{},n(this,z).toUpperCase()),s=this.controller.render(),r=this.synthesizer.render();return s||r?p("div",{class:"part"},e,s,r):null}}z=new WeakMap;function vt(t){return{bass:new A("bass",t.bass),drum:new A("drum",t.drum),keys:new A("keys",t.keys),lead:new A("lead",t.lead)}}const G=100;function kt(){return new Worker(new URL(""+new URL("worker-DxAA_dw-.js",import.meta.url).href,import.meta.url),{type:"module"})}var $,v,N,k,x,W,L,S,V,j,E,H;class Ot{constructor(e,s){u(this,E);u(this,$);u(this,v,kt());u(this,N);u(this,k,!1);u(this,x,[]);u(this,W,()=>{});u(this,L,0);u(this,S,0);u(this,V,6e4/120);u(this,j,new Set);a(this,$,e),a(this,N,vt(s)),n(this,v).onmessage=r=>this.schedule()}schedule(){const e=window.performance.now()-n(this,L)+G;for(;n(this,k)&&n(this,E,H)<e;){const s=n(this,x).shift();if(s)switch(s.type){case d.Tempo:a(this,V,6e4/s.bpm);break;case d.Finish:n(this,j).add(s.part),n(this,j).size===4&&n(this,$).stop();break;case d.NoteOn:s.part.synthesizer.noteOn(s.pitch,n(this,E,H));break;case d.NoteOff:s.part.synthesizer.noteOff(s.pitch,n(this,E,H));break}}}changeChart(e){a(this,W,()=>a(this,x,e.compose(n(this,N))))()}play(){a(this,k,!0),a(this,L,window.performance.now()+G),a(this,S,0),n(this,v).postMessage(0)}pause(){a(this,k,!1),n(this,v).postMessage(1),a(this,S,window.performance.now()-n(this,L))}resume(){a(this,k,!0),a(this,L,window.performance.now()-n(this,S)),n(this,v).postMessage(0)}stop(){a(this,k,!1),n(this,v).postMessage(1),a(this,S,0),n(this,j).clear(),n(this,W).call(this),setTimeout(()=>{for(const s of Object.values(n(this,N)))s.synthesizer.allNotesOff()},G)}render(){const e=Object.values(n(this,N)).map(s=>s.render());return e.some(s=>s!==null)?p("div",{id:"part-container"},...e):null}}$=new WeakMap,v=new WeakMap,N=new WeakMap,k=new WeakMap,x=new WeakMap,W=new WeakMap,L=new WeakMap,S=new WeakMap,V=new WeakMap,j=new WeakMap,E=new WeakSet,H=function(){return n(this,x).length===0?1/0:n(this,x)[0].position*n(this,V)};var m,w,y;class Pt{constructor(e){u(this,m,l.Paused);u(this,w,()=>{});u(this,y);console.debug("Playbacker",e),a(this,y,new Ot(this,e))}changeChart(e){console.debug("changeChart",e),n(this,y).changeChart(e),n(this,m)!=l.Stopped&&this.stop()}play(){switch(n(this,m)){case l.Playing:console.debug("already playing");break;case l.Paused:console.debug("resume"),n(this,w).call(this,g.Resume),a(this,m,l.Playing);break;case l.Stopped:console.debug("play"),n(this,w).call(this,g.Play),a(this,m,l.Playing);break}}pause(){switch(n(this,m)){case l.Playing:console.debug("pause"),n(this,w).call(this,g.Pause),a(this,m,l.Paused);break;case l.Paused:console.debug("already paused");break;case l.Stopped:console.debug("already stopped");break}}stop(){switch(n(this,m)){case l.Playing:console.debug("stop"),n(this,w).call(this,g.Stop),a(this,m,l.Stopped);break;case l.Paused:console.debug("stop"),n(this,w).call(this,g.Stop),a(this,m,l.Stopped);break;case l.Stopped:console.debug("already stopped");break}}connect(e){a(this,w,s=>{switch(s){case g.Play:n(this,y).play(),e.changePlayback(l.Playing);break;case g.Pause:n(this,y).pause(),e.changePlayback(l.Paused);break;case g.Resume:n(this,y).resume(),e.changePlayback(l.Playing);break;case g.Stop:n(this,y).stop(),e.changePlayback(l.Stopped);break}})}render(){return n(this,y).render()}}m=new WeakMap,w=new WeakMap,y=new WeakMap;function Ct(t){const e=new ct(t.transporter),s=new mt,r=new Pt(t.parts);e.connect(s,r),s.connect(e,r),r.connect(e);const o=e.render(),i=r.render(),c=o||i?p("div",{},o,i):null;return s.start(),c}it().then(t=>(e=>e?document.body.append(e):null)(Ct(t)));
</script>
  <style rel="stylesheet" crossorigin>:root{--red: #b23535;--green: #38ad5f;--blue: #464ca5;--white: #eeeade;--black: #282828;--text-color: var(--black);--background-color: var(--white)}@media (prefers-color-scheme: dark){:root{--text-color: var(--white);--background-color: var(--black)}}*{color:inherit;background-color:inherit;border-color:inherit;font-family:inherit;box-sizing:inherit}body{min-height:100vh;font-family:Arial,sans-serif;color:var(--text-color);background-color:var(--background-color);border-color:var(--text-color);box-sizing:border-box;padding:0;margin:0}.transporter-button{width:2em;height:2em;border:1.5px solid;border-radius:50%;font-size:2.5rem;padding:1rem;margin:0 .5rem 2rem;cursor:pointer;color:var(--background-color);background-color:var(--text-color);transition:transform .2s}.transporter-button:hover:enabled{transform:scale(1.1)}.transporter-button:disabled{color:var(--text-color);background-color:var(--background-color);cursor:auto}#transporter{text-align:center;border-bottom:1px solid var(--text-color)}.lcd{padding:.5em 1em;border-radius:5px;width:16ch;min-height:4em;line-height:1.5;text-align:left;font-family:hd44780,monospace;color:var(--background-color);background-color:var(--text-color)}input[type=range]{margin-top:1em;width:100%}.controller-module{padding:1em;display:flex;flex-direction:column;align-items:center;border:1px solid;font-size:1vw}.component-title{margin-top:0;margin-bottom:0;width:100%;height:3rem;line-height:3rem;cursor:pointer;-webkit-user-select:none;user-select:none}.controller-row{border-top:1px solid;justify-content:center;align-items:center;overflow-y:scroll;height:40vw}.controller{padding-top:0;border:1px solid}.part{text-align:center;border:1px solid;min-width:20%}#part-container{display:flex;flex-wrap:wrap;justify-content:space-around;align-items:start}.hidden{display:none}
</style>
</head>

<body>
</body>

</html>